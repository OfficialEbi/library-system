<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ› Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡</title>
  
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

  <style>
    /* ---------------------------------------------------
       1. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§
    --------------------------------------------------- */
    :root {
      --primary-color: #2563eb;       /* Ø¢Ø¨ÛŒ Ù…Ø¯Ø±Ù† (Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù†) */
      --secondary-color: #1e293b;     /* Ø³Ø±Ù…Ù‡â€ŒØ§ÛŒ ØªÛŒØ±Ù‡ (Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± Ùˆ ØªÛŒØªØ± Ø¬Ø¯Ø§ÙˆÙ„) */
      --accent-color: #f59e0b;        /* Ù†Ø§Ø±Ù†Ø¬ÛŒ/Ø·Ù„Ø§ÛŒÛŒ (Ø¨Ø±Ø§ÛŒ ØªØ§Ú©ÛŒØ¯) */
      --bg-color: #f3f4f6;            /* Ø®Ø§Ú©Ø³ØªØ±ÛŒ Ø®ÛŒÙ„ÛŒ Ø±ÙˆØ´Ù† Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø§ØµÙ„ÛŒ */
      --card-bg: #ffffff;
      --text-main: #334155;
      --text-light: #64748b;
      --danger: #ef4444;
      --success: #10b981;
      --radius: 12px;
      --shadow: 0 4px 15px rgba(0, 0, 0, 0.08); /* Ø³Ø§ÛŒÙ‡ Ù†Ø±Ù… Ùˆ Ù…Ø¯Ø±Ù† */
    }

    * {
      box-sizing: border-box;
      outline: none;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Vazirmatn', sans-serif;
      background: var(--bg-color);
      color: var(--text-main);
      overflow-x: hidden;
    }
    
    .dashboard-wrapper {
      display: flex; 
      min-height: 100vh;
      background: var(--bg-color); 
    }

    /* ---------------------------------------------------
       2. Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± (Ù…Ù†ÙˆÛŒ Ø±Ø§Ø³Øª)
    --------------------------------------------------- */
    .sidebar {
      width: 260px;
      background: var(--secondary-color); 
      box-shadow: 4px 0 15px rgba(0,0,0,0.15); 
      flex-shrink: 0; 
      padding: 25px 0;
      display: flex;
      flex-direction: column;
      position: sticky;
      top: 0;
      height: 100vh;
      box-sizing: border-box;
      z-index: 1000;
    }

    .sidebar h2 {
      font-size: 1.4rem;
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      color: #fff;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .sidebar-nav {
      flex-grow: 1; 
      padding: 0;
    }
    
    .sidebar-nav a {
      display: flex;
      align-items: center;
      color: #cbd5e1; 
      padding: 14px 25px;
      margin-bottom: 8px;
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .sidebar-nav a .material-icons-outlined {
        margin-left: 10px;
        font-size: 20px;
    }

    .sidebar-nav a:hover {
      background: rgba(255, 255, 255, 0.08);
      color: white;
      transform: translateX(-5px);
    }

    .sidebar-nav a.active {
      background: var(--primary-color); 
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
      border-right: 4px solid var(--accent-color); 
      transform: none;
    }

    .logout-link-container {
      margin-top: auto;
      border-top: 1px solid rgba(255,255,255,0.1);
      padding-top: 20px;
    }
    
    .logout-link-container a {
        color: var(--danger) !important;
    }
    .logout-link-container a:hover {
        background: transparent;
        color: #fff !important;
        transform: translateX(-5px);
    }

    /* ---------------------------------------------------
       3. Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ (content) Ùˆ ØªØ§ÛŒØªÙ„â€ŒÙ‡Ø§
    --------------------------------------------------- */
    .content {
      padding: 40px;
      width: calc(100% - 260px);
      transition: all 0.3s ease;
    }
    
    h2 {
      color: var(--secondary-color);
      font-size: 1.8rem;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
    }
    
    .section {
      display: none;
      animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ---------------------------------------------------
       4. Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
    --------------------------------------------------- */
    .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }
    .card {
        background: var(--card-bg);
        padding: 30px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        transition: transform 0.3s;
        border-right: 6px solid var(--primary-color);
    }
    .card h3 {
        font-size: 1rem;
        color: var(--text-light);
        margin-top: 0;
        margin-bottom: 10px;
        font-weight: 600;
    }
    .card p {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--secondary-color);
    }

    /* ---------------------------------------------------
       5. Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯Ø§ÙˆÙ„
    --------------------------------------------------- */
    table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-top: 20px;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        background: var(--card-bg);
    }
    th, td {
        padding: 15px 18px;
        text-align: right;
        font-size: 0.9rem;
    }
    th {
        background: var(--secondary-color);
        color: white;
        font-weight: 600;
    }
    tr:nth-child(even) {
        background-color: #f8fafc;
    }
    tr:hover {
        background-color: #f1f5f9;
    }
    
    /* ---------------------------------------------------
       6. Ø§Ø³ØªØ§ÛŒÙ„ ÙØ±Ù…â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ
    --------------------------------------------------- */
    .form-box {
        background: var(--card-bg);
        padding: 30px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 25px;
    }
    .form-box h3 {
        margin-top: 0;
    }
    .form-box input, .form-box select {
        width: 100%;
        padding: 12px;
        margin-bottom: 15px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        box-sizing: border-box;
        transition: border-color 0.3s;
    }
    .form-box input:focus, .form-box select:focus {
        border-color: var(--primary-color);
    }

    /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ù… Ø¨Ø§Ú©Ø³ (Ù…Ø«Ù„ Ø«Ø¨Øª Ú©ØªØ§Ø¨) */
    .form-box button {
        background: var(--primary-color);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s;
        display: inline-flex;
        align-items: center;
    }
    .form-box button:hover {
        background: #1d4ed8;
    }
    
    /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Ø¯Ø§Ø®Ù„ Ø¬Ø¯ÙˆÙ„ */
    .btn-action {
        display: inline-flex;
        align-items: center;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s;
        line-height: 1;
        margin-left: 5px;
    }
    
    .btn-edit {
        background: var(--primary-color);
        color: white;
    }
    .btn-edit:hover {
        background: #1d4ed8;
    }
    .btn-del {
        background: var(--danger);
        color: white;
    }
    .btn-del:hover {
        background: #b91c1c;
    }
    
    .btn-add-member {
        background: var(--success);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    .btn-add-member:hover {
        background: #059669;
    }
    
    .modal-content {
        background-color: var(--card-bg);
        margin: 10% auto;
        padding: 30px;
        border-radius: var(--radius);
        width: 50%;
        max-width: 650px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        position: relative;
        animation: fadeIn 0.3s;
    }

    /* ------------------ Ø·Ø±Ø­â€ŒØ¨Ù†Ø¯ÛŒ ÙØ±Ù… Ø¬Ø¯ÛŒØ¯ ------------------ */
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; /* Ø¯Ùˆ Ø³ØªÙˆÙ† Ù…Ø³Ø§ÙˆÛŒ */
        gap: 20px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† ÙÛŒÙ„Ø¯Ù‡Ø§ */
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 0; 
    }

    /* Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ØŒ ÙØ±Ù… ØªÚ© Ø³ØªÙˆÙ†Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ */
    @media (max-width: 768px) {
        .modal-content {
            width: 90%;
            margin: 5% auto;
        }
        .form-grid {
            grid-template-columns: 1fr; /* ÛŒÚ© Ø³ØªÙˆÙ† */
            gap: 15px;
        }
    }
    /* ---------------------------------------------------- */

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: var(--secondary-color);
    }
    /* ---------------------------------------------------
       7. Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ (Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„)
    --------------------------------------------------- */
    @media (max-width: 900px) {
        .dashboard-wrapper {
            flex-direction: column; 
        }
        .sidebar {
            width: 100%; 
            height: auto;
            position: static;
            padding: 15px 0;
            flex-direction: row; 
            align-items: center;
        }
        .sidebar h2 {
            display: none; 
        }
        .sidebar-nav {
            flex-direction: row; 
            flex-wrap: wrap; 
            justify-content: space-around;
            width: 100%;
        }
        .sidebar-nav a {
            padding: 12px 10px;
            flex-direction: column; 
            flex-basis: 30%; 
            text-align: center;
            border-right: none !important;
            transform: none !important;
            margin-bottom: 0;
        }
        .sidebar-nav a .material-icons-outlined {
            margin: 0 0 5px 0;
        }
        .content {
            padding: 20px;
            width: 100%;
        }
        .dashboard-cards {
            grid-template-columns: 1fr;
        }
        .logout-link-container {
            display: none; 
        }
    }

    /* ================================
   Ú¯Ø±ÛŒØ¯ ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ØªØ§Ø¨
================================ */
.edit-form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px 18px;
  margin-bottom: 25px;
}

.edit-form-grid label {
  display: block;
  font-size: 0.85rem;
  font-weight: 600;
  margin-bottom: 6px;
  color: #334155;
}

.edit-form-grid input {
  width: 100%;
  padding: 11px 12px;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  font-family: 'Vazirmatn', sans-serif;
  font-size: 0.95rem;
}

.edit-form-grid input:focus {
  border-color: var(--primary-color);
}
/* ================================
   Ù„Ø§ÛŒÙ‡ Ù…ÙˆØ¯Ø§Ù„ (Ù…Ø±Ú©Ø²Ú†ÛŒÙ† Ú©Ø§Ù…Ù„)
================================ */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  display: flex;
  align-items: center;     /* â¬…ï¸ ÙˆØ³Ø· Ø¹Ù…ÙˆØ¯ÛŒ */
  justify-content: center; /* â¬…ï¸ ÙˆØ³Ø· Ø§ÙÙ‚ÛŒ */
  z-index: 9999;
}


/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ† Ù…ÙˆØ¯Ø§Ù„ */
.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.modal-actions button {
  padding: 10px 18px;
  border-radius: 8px;
  border: none;
  font-weight: 600;
  cursor: pointer;
}

.modal-actions button:first-child {
  background: var(--primary-color);
  color: white;
}

.modal-actions .cancel {
  background: #e5e7eb;
  color: #1f2937;
}    

  </style>

</head>
<body>

  <div class="dashboard-wrapper">
    
    <div class="sidebar">
      <h2><span class="material-icons-outlined" style="margin-left: 8px; color: var(--accent-color);">settings_account_box</span> Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†</h2>
      
      <div class="sidebar-nav">
        <a class="active" onclick="showSection('dashboard', this)">
            <span class="material-icons-outlined">home</span> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
        </a>
        <a onclick="showSection('books', this)">
            <span class="material-icons-outlined">auto_stories</span> Ù…Ø¯ÛŒØ±ÛŒØª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
        </a>
        <a onclick="showSection('addBook', this)">
            <span class="material-icons-outlined">add_box</span> Ø§ÙØ²ÙˆØ¯Ù† Ú©ØªØ§Ø¨
        </a>
        <a onclick="showSection('users', this)">
            <span class="material-icons-outlined">group</span> Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
        </a>
        <a onclick="showSection('borrows', this)">
            <span class="material-icons-outlined">swap_horiz</span> Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù…Ø§Ù†Øªâ€ŒÙ‡Ø§
        </a>
        <a onclick="showSection('stats', this)">
            <span class="material-icons-outlined">bar_chart</span> Ø¢Ù…Ø§Ø±
        </a>
        
        <div class="logout-link-container">
            <a onclick="logout()">
                <span class="material-icons-outlined">logout</span> Ø®Ø±ÙˆØ¬
            </a>
        </div>
      </div>
    </div>

    <div class="content">

      <div id="dashboard" class="section active">
        <h2><span class="material-icons-outlined">dashboard</span> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
        <div class="dashboard-cards">
          <div class="card">
            <h3>ğŸ“š ØªØ¹Ø¯Ø§Ø¯ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§</h3>
            <p id="countBooks">...</p>
          </div>
          <div class="card">
            <h3>ğŸ‘¤ Ø§Ø¹Ø¶Ø§ÛŒ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡</h3>
            <p id="countUsers">...</p>
          </div>
          <div class="card">
            <h3>ğŸ” Ø§Ù…Ø§Ù†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h3>
            <p id="countBorrows">...</p>
          </div>
        </div>
      </div>

      <div id="books" class="section">
        <h2><span class="material-icons-outlined">auto_stories</span> Ù…Ø¯ÛŒØ±ÛŒØª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§</h2>
        <table class="data-table">
  <thead>
    <tr>
      <th>Ø´Ù†Ø§Ø³Ù‡</th>
      <th>Ø¹Ù†ÙˆØ§Ù†</th>
      <th>Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡</th>
      <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
      <th>**ISBN**</th> <th>Ø³Ø§Ù„ Ú†Ø§Ù¾</th>
      <th>**Ù‚ÙØ³Ù‡**</th> <th>Ú©Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th>
      <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³</th>
      <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
    </tr>
  </thead>
  <tbody id="booksTableBody">
    </tbody>
</table>
      </div>

      <div id="addBook" class="section">
        <h2><span class="material-icons-outlined">add_box</span> Ø§ÙØ²ÙˆØ¯Ù† Ú©ØªØ§Ø¨ Ø¬Ø¯ÛŒØ¯</h2>
        <div class="form-box" style="max-width: 700px; margin: auto;"> 
          <h3>ğŸ“š Ø§ÙØ²ÙˆØ¯Ù† Ú©ØªØ§Ø¨ Ø¬Ø¯ÛŒØ¯</h3>
          <form id="addBookForm">
            
            <div class="form-grid">
              
              <div class="form-group">
                <label for="newTitle">Ø¹Ù†ÙˆØ§Ù† Ú©ØªØ§Ø¨:</label>
                <input type="text" id="newTitle" required>
              </div>
              
              <div class="form-group">
                <label for="newAuthor">Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡:</label>
                <input type="text" id="newAuthor" required>
              </div>
              
              <div class="form-group">
                <label for="newCategory">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</label>
                <input type="text" id="newCategory" required>
              </div>

              <div class="form-group">
                <label for="newIsbn">ISBN:</label>
                <input type="text" id="newIsbn" required>
              </div>

              <div class="form-group">
                <label for="newYear">Ø³Ø§Ù„ Ú†Ø§Ù¾:</label>
                <input type="number" id="newYear" required min="1300" max="1500">
              </div>
              
              <div class="form-group">
                <label for="newTotalCopies">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ:</label>
                <input type="number" id="newTotalCopies" required min="1">
              </div>
              
              <div class="form-group">
                <label for="newShelfNumber">Ø´Ù…Ø§Ø±Ù‡ Ù‚ÙØ³Ù‡:</label>
                <input type="text" id="newShelfNumber" required>
              </div>
              <div class="form-group">
  <label for="newImage">Ø¹Ú©Ø³ Ú©ØªØ§Ø¨ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
  <input type="file" id="newImage" accept="image/*">
</div>


              </div>
            <button type="submit" class="btn-primary" style="margin-top: 20px; width: 100%;">Ø«Ø¨Øª Ú©ØªØ§Ø¨</button>
          </form>
        </div>
      </div>

      <div id="users" class="section">
        <h2><span class="material-icons-outlined">group</span> Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>

        <button class="btn-add-member" onclick="showAddMemberForm()">
          <span class="material-icons-outlined">person_add</span> Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯
        </button>

        <div id="addMemberBox" class="form-box" style="display:none;margin-top:20px; border-right: 4px solid var(--accent-color);">
          <h3>Ø«Ø¨Øª Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯</h3>
          <input id="mName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
          <input id="mEmail" placeholder="Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„">
          <input id="mPassword" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
          <select id="mRole">
            <option value="member">Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ</option>
            <option value="admin">Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</option>
          </select>
          <button onclick="addMember()">Ø«Ø¨Øª Ú©Ø§Ø±Ø¨Ø±</button>
        </div>

        <table>
          <thead>
            <tr>
              <th>Ù†Ø§Ù…</th>
              <th>Ø§ÛŒÙ…ÛŒÙ„</th>
              <th>Ù†Ù‚Ø´</th>
              <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
          </thead>
          <tbody id="usersTable"></tbody>
        </table>
      </div>

      <div id="borrows" class="section">
        <h2><span class="material-icons-outlined">swap_horiz</span> Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù…Ø§Ù†Øªâ€ŒÙ‡Ø§</h2>

        <div style="margin:20px 0; display:flex; gap:10px;">
          <button class="btn-action btn-edit" onclick="loadBorrows('active')">
            <span class="material-icons-outlined">check_circle_outline</span> Ø§Ù…Ø§Ù†Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø§Ø±ÛŒ
          </button>
          <button class="btn-action" style="background:var(--text-light); color:white;" onclick="loadBorrows('returned')">
            <span class="material-icons-outlined">history</span> ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª
          </button>
        </div>

        <table>
          <thead>
            <tr>
              <th>Ø¹Ø¶Ùˆ</th>
              <th>Ú©ØªØ§Ø¨</th>
              <th>ØªØ§Ø±ÛŒØ® Ø§Ù…Ø§Ù†Øª</th>
              <th>ÙˆØ¶Ø¹ÛŒØª</th>
              <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
          </thead>
          <tbody id="borrowsTable">
            <tr><td colspan="5">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td></tr>
          </tbody>
        </table>
      </div>

      <div id="stats" class="section">
        <h2><span class="material-icons-outlined">bar_chart</span> Ø¢Ù…Ø§Ø± Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</h2>
        <div class="dashboard-cards">
          <div class="card" style="border-right-color: var(--success);">
            <h3>ğŸ“š Ú©Ù„ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡</h3>
            <p id="statsTotalBooks">...</p>
          </div>
          <div class="card" style="border-right-color: var(--accent-color);">
            <h3>ğŸ‘¤ Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡</h3>
            <p id="statsTotalUsers">...</p>
          </div>
          <div class="card" style="border-right-color: var(--danger);">
            <h3>ğŸ” Ú©Ù„ Ø§Ù…Ø§Ù†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h3>
            <p id="statsTotalBorrows">...</p>
          </div>
        </div>
        
      </div>

    </div>
  </div>

<script>
    const API = "http://localhost:3000";
    const token = localStorage.getItem("token");
// =========================
// Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´
// =========================
let booksCache = [];

    function showSection(id, el) {
      document.querySelectorAll(".section")
        .forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");

      if(el) {
          document.querySelectorAll(".sidebar-nav a") 
            .forEach(link => link.classList.remove("active"));
          el.classList.add("active");
      }

      if (id === "borrows") {
        loadBorrows("active");
      }
      
      if (id === "books") {
        loadBooks();
      }
      
      if (id === "users") {
        loadUsers();
      }
    }

    function logout() {
      localStorage.removeItem("token");
      localStorage.removeItem("user");
      window.location.href = "index.html";
    }
// =========================
// Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ØªØ§Ø¨ Ø¨Ø§ ID
// =========================
function openEditBookById(id) {
  const book = booksCache.find(b => b.id === id);

  if (!book) {
    alert("âŒ Ú©ØªØ§Ø¨ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");
    return;
  }

  document.getElementById("editBookId").value = book.id;
  document.getElementById("editTitle").value = book.title;
  document.getElementById("editAuthor").value = book.author;
  document.getElementById("editCategory").value = book.category || "";
  document.getElementById("editIsbn").value = book.isbn || "";
  document.getElementById("editYear").value = book.publication_year;
  document.getElementById("editTotalCopies").value = book.total_copies;
  document.getElementById("editShelfNumber").value = book.shelf_number || "";

  document.getElementById("editBookModal").style.display = "flex";
}

// =========================
// Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ØªØ§Ø¨
// =========================
function closeEditModal() {
  document.getElementById("editBookModal").style.display = "none";
}
// =========================
// Ø§Ø±Ø³Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ØªØ§Ø¨ Ø¨Ù‡ Ø³Ø±ÙˆØ±
// Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ Ø¹Ú©Ø³ Ø§Ø®ØªÛŒØ§Ø±ÛŒ
// =========================
async function submitEditBook() {
  const id = document.getElementById("editBookId").value;
  const token = localStorage.getItem("token");

  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² FormData Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø¹Ú©Ø³
  const formData = new FormData();

  formData.append("title", document.getElementById("editTitle").value);
  formData.append("author", document.getElementById("editAuthor").value);
  formData.append("category", document.getElementById("editCategory").value);
  formData.append("isbn", document.getElementById("editIsbn").value);
  formData.append("publication_year", document.getElementById("editYear").value);
  formData.append("total_copies", document.getElementById("editTotalCopies").value);
  formData.append("shelf_number", document.getElementById("editShelfNumber").value);

  // Ø§Ú¯Ø± Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
  const imageInput = document.getElementById("editImage");
  if (imageInput.files.length > 0) {
    formData.append("image", imageInput.files[0]);
  }

  const res = await fetch(`${API}/api/books/${id}`, {
    method: "PUT",
    headers: {
      Authorization: "Bearer " + token
      // â— Content-Type Ø¹Ù…Ø¯Ø§Ù‹ ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ (multer Ø®ÙˆØ¯Ø´ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯)
    },
    body: formData
  });

  const data = await res.json();

  if (res.ok) {
    alert("âœ… Ú©ØªØ§Ø¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯");
    closeEditModal();
    loadBooks();
  } else {
    alert("âŒ Ø®Ø·Ø§: " + (data.error || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ"));
  }
}


    /* -----------------------------
       Ù„ÙˆØ¯ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ (Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ÛŒÙ† Ø¨Ø®Ø´ØŒ Ø¨Ø®Ø´ Ø¢Ù…Ø§Ø± Ø±Ø§ Ù†ÛŒØ² Ù¾Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
    -----------------------------*/
    async function loadDashboard() {
      try {
        // --- 1. Ø¢Ù…Ø§Ø± Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) ---
        const resBooks = await fetch(`${API}/api/stats/books`, {
          headers: { "Authorization": "Bearer " + token }
        });
        const books = await resBooks.json();
        document.getElementById("countBooks").innerText = books.count;
        document.getElementById("statsTotalBooks").innerText = books.count;

        // --- 2. Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) ---
        const resUsers = await fetch(`${API}/api/stats/users`, {
          headers: { "Authorization": "Bearer " + token }
        });
        const users = await resUsers.json();
        document.getElementById("countUsers").innerText = users.count;
        document.getElementById("statsTotalUsers").innerText = users.count;


        // --- 3. Ø¢Ù…Ø§Ø± Ø§Ù…Ø§Ù†Øªâ€ŒÙ‡Ø§ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯) ---
        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡Ù…Ø§Ù† Ø¢Ø¯Ø±Ø³ Ù„ÙˆØ¯ Ù„ÛŒØ³Øª Ø§Ù…Ø§Ù†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ùˆ Ú¯Ø±ÙØªÙ† Ø·ÙˆÙ„ Ø¢Ø±Ø§ÛŒÙ‡
        const resBorrows = await fetch(`${API}/api/borrows/active`, { 
          headers: { "Authorization": "Bearer " + token }
        });
        const borrows = await resBorrows.json(); 
        
        const activeBorrowsCount = Array.isArray(borrows) ? borrows.length : 0; // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ø§Ù…Ø§Ù†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
        document.getElementById("countBorrows").innerText = activeBorrowsCount;
        document.getElementById("statsTotalBorrows").innerText = activeBorrowsCount;

      } catch (err) {
        console.log("âŒ Error loading dashboard:", err);
        // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ù†Ù…Ø§ÛŒØ´ 'Ø®Ø·Ø§'
        document.getElementById("countBooks").innerText = 'Ø®Ø·Ø§';
        document.getElementById("countUsers").innerText = 'Ø®Ø·Ø§';
        document.getElementById("countBorrows").innerText = 'Ø®Ø·Ø§';
        document.getElementById("statsTotalBooks").innerText = 'Ø®Ø·Ø§';
        document.getElementById("statsTotalUsers").innerText = 'Ø®Ø·Ø§';
        document.getElementById("statsTotalBorrows").innerText = 'Ø®Ø·Ø§';
      }
    }

    /* -----------------------------
       Ù„ÙˆØ¯ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
    -----------------------------*/
    /* ---------------------------------------------------
   Ù„ÙˆØ¯ Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†)
--------------------------------------------------- */
async function loadBooks() {
  const booksTableBody = document.getElementById("booksTableBody");
  booksTableBody.innerHTML = `<tr><td colspan="10" class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§...</td></tr>`;

  try {
    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² API Ø¬Ø¯ÛŒØ¯ admin/books
    const res = await fetch(`${API}/api/admin/books`, {
      headers: {
        Authorization: "Bearer " + token
      }
    });

    if (res.status === 401 || res.status === 403) {
      booksTableBody.innerHTML = `<tr><td colspan="10" class="error">Ø´Ù…Ø§ Ù…Ø¬ÙˆØ² Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</td></tr>`;
      return;
    }

    const books = await res.json();
    // Ø°Ø®ÛŒØ±Ù‡ Ù„ÛŒØ³Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´
booksCache = books;

    if (books.length === 0) {
      booksTableBody.innerHTML = `<tr><td colspan="10" class="empty-list">Ú©ØªØ§Ø¨ÛŒ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>`;
      return;
    }

    booksTableBody.innerHTML = books.map(b => {
      const isAvailable = b.available_copies > 0;
      const availableColor = isAvailable ? 'var(--success)' : 'var(--danger)';

      return `
        <tr>
          <td>${b.id}</td>
          <td>${b.title}</td>
          <td>${b.author}</td>
          <td>${b.category}</td>
          <td>${b.isbn}</td>              <td>${b.publication_year}</td>
          <td>${b.shelf_number}</td>      <td>${b.total_copies}</td>
          <td style="font-weight: bold; color: ${availableColor};">${b.available_copies}</td>
          <td>
            <button class="btn-action btn-edit" onclick="openEditBookById(${b.id})">
  <span class="material-icons-outlined" style="font-size:16px;">edit</span>
  ÙˆÛŒØ±Ø§ÛŒØ´
</button>

            <button class="btn-action btn-delete" onclick="deleteBook(${b.id})">
              <span class="material-icons-outlined" style="font-size:16px;">delete</span>
              Ø­Ø°Ù
            </button>
          </td>
        </tr>
      `;
    }).join("");

  } catch (error) {
    console.error("Error loading books:", error);
    booksTableBody.innerHTML = `<tr><td colspan="10" class="error">Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§.</td></tr>`;
  }
}

/* -----------------------------
    ØªØ§Ø¨Ø¹ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ØªØ§Ø¨ (Ù†Ù‡Ø§ÛŒÛŒ Ø´Ø¯Ù‡ Ùˆ Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú©Ø§Ù…Ù„)
    -----------------------------*/
function editBook(book) {
    const token = localStorage.getItem("token"); 

    // âš ï¸ Ú†Ú© Ú©Ø±Ø¯Ù† ØªÙˆÚ©Ù† Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„
    if (!token) {
        alert("âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯.");
        return;
    }

    // Ø¬Ù…Ø¹ Ø¢ÙˆØ±ÛŒ Ø¯Ø§Ø¯Ù‡ Ù‡Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ prompt
    const newTitle = prompt("Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÛŒØ¯:", book.title);
    const newAuthor = prompt("Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯:", book.author);
    const newYear = prompt("Ø³Ø§Ù„ Ø§Ù†ØªØ´Ø§Ø± Ø¬Ø¯ÛŒØ¯:", book.publication_year);
    const newCategory = prompt("Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯:", book.category);

    const newIsbn = prompt("ISBN Ø¬Ø¯ÛŒØ¯:", book.isbn || ""); 
    const newTotalCopies = prompt("ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯:", book.total_copies || book.available_copies); 
    const newShelfNumber = prompt("Ø´Ù…Ø§Ø±Ù‡ Ù‚ÙØ³Ù‡ Ø¬Ø¯ÛŒØ¯:", book.shelf_number || "");

    if (!newTitle) return; // Ø§Ú¯Ø± Ú©Ù†Ø³Ù„ Ø´Ø¯

    const payload = {
        title: newTitle,
        author: newAuthor,
        publication_year: newYear,
        category: newCategory,
        isbn: newIsbn,
        total_copies: newTotalCopies, 
        shelf_number: newShelfNumber,
    };

    fetch(`${API}/api/books/${book.id}`, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token
        },
        body: JSON.stringify(payload)
    })
    .then(async (res) => {
        const data = await res.json();
        
        if (res.ok) {
            alert("âœ… Ú©ØªØ§Ø¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯");
            loadBooks();
        } else {
            // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø³Ø±ÙˆØ± (Ù…Ø§Ù†Ù†Ø¯ "Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ù…ØªØ± Ø§Ø² ØªØ¹Ø¯Ø§Ø¯ Ø§Ù…Ø§Ù†Øª Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯")
            alert(`âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ØªØ§Ø¨ (Ú©Ø¯ Ø®Ø·Ø§: ${res.status}): ${data.error || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ'}`);
        }
    })
    .catch(err => {
        console.error("Fetch Error:", err);
        alert("âŒ Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± ÛŒØ§ Ù…Ø´Ú©Ù„ Ø´Ø¨Ú©Ù‡.");
    });
}

    /* -----------------------------
       Ø°Ø®ÛŒØ±Ù‡ Ú©ØªØ§Ø¨ Ø¬Ø¯ÛŒØ¯
    -----------------------------*/
    const titleInput = document.getElementById("title");
    const authorInput = document.getElementById("author");
    const yearInput = document.getElementById("year");
    const categoryInput = document.getElementById("category");
    const copiesInput = document.getElementById("copies");

    async function saveBook() {
      const title = titleInput.value.trim();
      const author = authorInput.value.trim();
      const year = yearInput.value.trim();
      const category = categoryInput.value.trim();
      const copies = copiesInput.value.trim();

      if (!title || !author || !year || !copies) {
        alert("ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
        return;
      }

      fetch(`${API}/api/books`, {
        method: "POST",
        headers: {
          Authorization: "Bearer " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          title,
          author,
          category,
          publication_year: year,
          available_copies: copies
        })
      })
        .then(res => res.json())
        .then(() => {
          alert("Ú©ØªØ§Ø¨ Ø«Ø¨Øª Ø´Ø¯");
          titleInput.value = '';
          authorInput.value = '';
          yearInput.value = '';
          categoryInput.value = '';
          copiesInput.value = '';
        });
    }
    /* ---------------------------------------------------
   Ø§ÙØ²ÙˆØ¯Ù† Ú©ØªØ§Ø¨ Ø¬Ø¯ÛŒØ¯
--------------------------------------------------- */
    document.getElementById("addBookForm").onsubmit = async (e) => {
  e.preventDefault();

  const token = localStorage.getItem("token");

  const formData = new FormData();
  formData.append("title", document.getElementById("newTitle").value.trim());
  formData.append("author", document.getElementById("newAuthor").value.trim());
  formData.append("category", document.getElementById("newCategory").value.trim());
  formData.append("isbn", document.getElementById("newIsbn").value.trim());
  formData.append("publication_year", document.getElementById("newYear").value);
  formData.append("total_copies", document.getElementById("newTotalCopies").value);
  formData.append("shelf_number", document.getElementById("newShelfNumber").value);

  // ğŸ‘‡ Ø¹Ú©Ø³ Ø§Ø®ØªÛŒØ§Ø±ÛŒ
  const imageInput = document.getElementById("newImage");
  if (imageInput && imageInput.files.length > 0) {
    formData.append("image", imageInput.files[0]);
  }

  try {
    const res = await fetch(`${API}/api/books`, {
      method: "POST",
      headers: {
        Authorization: "Bearer " + token
        // âŒ Content-Type Ù†Ø°Ø§Ø± (multer Ø®ÙˆØ¯Ø´ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
      },
      body: formData
    });

    const data = await res.json();

    if (res.ok) {
      alert("âœ… Ú©ØªØ§Ø¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯");
      document.getElementById("addBookForm").reset();
      loadBooks();
    } else {
      alert(`âŒ Ø®Ø·Ø§: ${data.error || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ"}`);
    }

  } catch (err) {
    console.error(err);
    alert("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±");
  }
};
 
    /* -----------------------------
       Ø­Ø°Ù Ú©ØªØ§Ø¨
    -----------------------------*/
    async function deleteBook(id) {
      if (!confirm("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ú©ØªØ§Ø¨ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ")) return;

      await fetch(`${API}/api/books/${id}`, {
        method: "DELETE",
        headers: { Authorization: "Bearer " + token },
      });

      alert("Ú©ØªØ§Ø¨ Ø­Ø°Ù Ø´Ø¯");
      loadBooks();
    }

    /* =============================
       Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ø¶Ø§
    =============================*/

    function showAddMemberForm() {
      document.getElementById("addMemberBox").style.display = 
         document.getElementById("addMemberBox").style.display === "block" ? "none" : "block";
    }

    /* Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ø¶Ùˆ */
    async function addMember() {
      const name = document.getElementById("mName").value;
      const email = document.getElementById("mEmail").value;
      const password = document.getElementById("mPassword").value;
      const role = document.getElementById("mRole").value;

      const res = await fetch(`${API}/api/admin/users`, {
        method: "POST",
        headers: {
          Authorization: "Bearer " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ name, email, password, role })
      });

      const data = await res.json();
      alert(data.message || data.error);

      loadUsers();
    }

    /* ÙˆÛŒØ±Ø§ÛŒØ´ Ø¹Ø¶Ùˆ */
    function editUser(u) {
      const newName = prompt("Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯:", u.name);
      const newEmail = prompt("Ø§ÛŒÙ…ÛŒÙ„ Ø¬Ø¯ÛŒØ¯:", u.email);
      const newRole = prompt("Ù†Ù‚Ø´ Ø¬Ø¯ÛŒØ¯ (admin/member/pending):", u.role);
      
      if (!newName) return;

      fetch(`${API}/api/admin/users/${u.id}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + token
        },
        body: JSON.stringify({
          name: newName,
          email: newEmail,
          role: newRole
        })
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message);
        loadUsers();
      });
    }

    /* Ø­Ø°Ù Ø¹Ø¶Ùˆ */
    function deleteUser(id) {
      if (!confirm("Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±ØŸ")) return;

      fetch(`${API}/api/admin/users/${id}`, {
        method: "DELETE",
        headers: { Authorization: "Bearer " + token }
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message);
        loadUsers();
      });
    }

    /* ØªØ§ÛŒÛŒØ¯ Ø¹Ø¶Ùˆ Pending */
    async function approveUser(id) {
      await fetch(`${API}/api/users/${id}/approve`, {
        method: "PUT",
        headers: { Authorization: "Bearer " + token },
      });

      alert("Ú©Ø§Ø±Ø¨Ø± ØªØ§ÛŒÛŒØ¯ Ø´Ø¯");
      loadUsers();
    }

    /* -----------------------------
       Ù„ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
    -----------------------------*/
    async function loadUsers() {
      const res = await fetch(`${API}/api/users`, {
        headers: { Authorization: "Bearer " + token },
      });
      const users = await res.json();

      document.getElementById("usersTable").innerHTML = users
        .map(
          (u) => `
        <tr>
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>
             <span style="padding:4px 8px; border-radius:4px; font-size:0.8rem; background:${u.role === 'admin' ? '#dbeafe' : (u.role === 'member' ? '#e5e7eb' : '#fff3cd')}; color:${u.role === 'admin' ? '#1e40af' : (u.role === 'member' ? '#374151' : '#856404')}">
               ${u.role}
             </span>
          </td>
          <td>
            <button class="btn-action btn-edit" onclick='editUser(${JSON.stringify(u)})'>
                <span class="material-icons-outlined" style="font-size:16px;">edit</span>
            </button>
            ${
              u.role === "pending"
                ? `<button class="btn-action" style="background:var(--accent-color);color:black" onclick="approveUser(${u.id})">
                     <span class="material-icons-outlined" style="font-size:16px;">check_circle</span>
                   </button>`
                : ``
            }
             <button class="btn-action btn-del" onclick="deleteUser(${u.id})">
                <span class="material-icons-outlined" style="font-size:16px;">delete</span>
            </button>
          </td>
        </tr>`
        )
        .join("");
    }


    /* =============================
       Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù…Ø§Ù†Øªâ€ŒÙ‡Ø§
    ============================= */

    async function loadBorrows(type = "active") {
      const endpoint =
        type === "returned"
          ? `${API}/api/borrows/history`
          : `${API}/api/borrows/active`;

      const res = await fetch(endpoint, {
        headers: { Authorization: "Bearer " + token }
      });

      const borrows = await res.json();
      const tbody = document.getElementById("borrowsTable");

      if (!borrows || borrows.length === 0) {
        tbody.innerHTML =
          `<tr><td colspan="5" style="padding:20px; color:#999; text-align:center;">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td></tr>`;
        return;
      }

      tbody.innerHTML = borrows.map(b => {
        const borrowDate = new Date(b.borrow_date);
        const returnDate = b.return_date ? new Date(b.return_date) : null;

        const dueDate = new Date(borrowDate);
        dueDate.setDate(dueDate.getDate() + 14);

        let statusText = "Ø¯Ø± Ù…Ù‡Ù„Øª";
        let statusColor = "var(--success)";

        if (!returnDate && new Date() > dueDate) {
          const delayDays =
            Math.ceil((new Date() - dueDate) / (1000 * 60 * 60 * 24));
          statusText = `ØªØ§Ø®ÛŒØ± ${delayDays} Ø±ÙˆØ²`;
          statusColor = "var(--danger)";
        }

        if (returnDate) {
          statusText = "Ø¨Ø§Ø²Ú¯Ø´Øª Ø´Ø¯Ù‡";
          statusColor = "#64748b";
        }

        return `
          <tr>
            <td style="font-weight:bold">${b.member}</td>
            <td>${b.title}</td>
            <td>${borrowDate.toLocaleDateString("fa-IR")}</td>
            <td style="color:${statusColor};font-weight:bold;">
              ${statusText}
            </td>
            <td>
              ${
                !returnDate
                  ? `<button class="btn-action btn-edit" onclick="returnBorrow(${b.id})">
                       <span class="material-icons-outlined" style="font-size:16px;">keyboard_return</span>
                       Ø«Ø¨Øª Ø¨Ø§Ø²Ú¯Ø´Øª
                     </button>`
                  : "â€”"
              }
            </td>
          </tr>
        `;
      }).join("");
    }

    async function returnBorrow(borrowId) {
      if (!confirm("Ú©ØªØ§Ø¨ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´ÙˆØ¯ØŸ")) return;

      const res = await fetch(`${API}/api/return/${borrowId}`, {
        method: "POST",
        headers: {
          Authorization: "Bearer " + token
        }
      });

      const data = await res.json();
      alert(data.message || data.error);

      loadDashboard();
      if(document.getElementById('borrows').classList.contains('active')){
         loadBorrows('active');
      }
    }


    /* -----------------------------
       Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    -----------------------------*/
    loadDashboard();
</script>
<!-- ============================= -->
<!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ØªØ§Ø¨ (Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ) -->
<!-- ============================= -->
<div id="editBookModal" class="modal">
  <div class="modal-content">

    <h3>âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©ØªØ§Ø¨</h3>

    <input type="hidden" id="editBookId">

    <!-- Ú¯Ø±ÛŒØ¯ ÙØ±Ù… -->
    <div class="edit-form-grid">

      <div>
        <label>Ø¹Ù†ÙˆØ§Ù† Ú©ØªØ§Ø¨</label>
        <input id="editTitle" type="text">
      </div>

      <div>
        <label>Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡</label>
        <input id="editAuthor" type="text">
      </div>

      <div>
        <label>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
        <input id="editCategory" type="text">
      </div>

      <div>
        <label>ISBN</label>
        <input id="editIsbn" type="text">
      </div>

      <div>
        <label>Ø³Ø§Ù„ Ú†Ø§Ù¾</label>
        <input id="editYear" type="number">
      </div>

      <div>
        <label>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„</label>
        <input id="editTotalCopies" type="number">
      </div>

      <div>
        <label>Ø´Ù…Ø§Ø±Ù‡ Ù‚ÙØ³Ù‡</label>
        <input id="editShelfNumber" type="text">
      </div>

      <div>
        <label>Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
        <input id="editImage" type="file" accept="image/*">
      </div>

    </div>

    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
    <div class="modal-actions">
      <button onclick="submitEditBook()">Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
      <button class="cancel" onclick="closeEditModal()">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>

  </div>
</div>


</body>
</html>