<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>๐ ุณุงูุงูู ูุฏุฑุช ฺฉุชุงุจุฎุงูู ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrapper">

  <!-- Header -->
  <header>
    <div class="container">
      <h1>๐ ฺฉุชุงุจุฎุงูู ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู</h1>
      <nav>
        <ul>
          <li><a href="#" class="active">ุฎุงูู</a></li>
          <li><a href="#">ฺฉุชุงุจโูุง</a></li>
          <li><a href="#">ุฏุฑุจุงุฑู ูุง</a></li>
          <li><a href="#">ุชูุงุณ</a></li>
        </ul>
      </nav>

      <div class="header-icons">
        <span id="userNameDisplay" class="user-name"></span>

        <button id="openAuth" title="ูุฑูุฏ">ูุฑูุฏ</button>
        <button id="logoutBtn" style="display:none;" title="ุฎุฑูุฌ">๐ช</button>

        <div id="userMenu" class="user-menu" style="display:none;">
          <p id="menuUserName">ูุงู ฺฉุงุฑุจุฑ</p>
          <button id="menuProfile">ูพุฑููุงู</button>
          <button id="menuLogout">ุฎุฑูุฌ</button>
        </div>

        <button title="ุชูุธูุงุช">โ๏ธ</button>
      </div>

    </div>
  </header>

  <!-- ูพุงู Pending -->
  <div id="pendingBox" style="
    display:none;
    background:#fff3cd;
    color:#7f6500;
    border:1px solid #ffeeba;
    padding:12px;
    margin:15px auto;
    width:90%;
    border-radius:8px;
    text-align:center;
    font-weight:bold;
    font-size:15px;
  ">
    ุญุณุงุจ ุดูุง ูููุฒ ุชูุณุท ูุฏุฑ ุชุงุฏ ูุดุฏู ุงุณุช. ูุทูุงู ููุชุธุฑ ุชุงุฏ ุจูุงูุฏ.
  </div>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-content">
      <h2>ุจู ุณุงูุงูู ูุฏุฑุช ฺฉุชุงุจุฎุงูู ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู ุฎูุด ุขูุฏุฏ</h2>
      <p>ุฏุณุชุฑุณ ุขุณุงู ุจู ฺฉุชุงุจโูุงุ ูุดุฑุงุช ู ููุงุจุน ุขููุฒุด ุฏุฑ ฺฉ ูฺฉุงู</p>
    </div>
  </section>

  <!-- Search -->
  <section class="search-area">
    <div class="tabs"></div>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="ุนุจุงุฑุช ููุฑุฏ ูุธุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ ...">
      <button id="searchBtn">๐ ุฌุณุชุฌู</button>
    </div>
  </section>

  <!-- Stats -->
  <section class="stats">
    <div class="stat-card">
      <div class="icon">๐</div>
      <h3>ูุฌููุน ฺฉุชุงุจโูุง</h3>
      <p id="totalBooks">...</p>
    </div>
    <div class="stat-card">
      <div class="icon">๐ค</div>
      <h3>ุงุนุถุง</h3>
      <p>ฒ</p>
    </div>
    <div class="stat-card">
      <div class="icon">๐</div>
      <h3>ุงูุงูุชโ ูุง ูุนุงู ุงู ูุงู</h3>
      <p>ฒฒ</p>
    </div>
  </section>

  <!-- New Books -->
  <section class="new-books">
    <h2>๐ ุชุงุฒูโูุง ฺฉุชุงุจ</h2>
    <div id="bookGrid" class="book-grid">
      <p style="text-align:center;color:#555;">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ ฺฉุชุงุจโูุง...</p>
    </div>
  </section>

<!-- Footer -->
<footer>
  <div class="footer-container">
    <div class="footer-col">
      <h3>ุฏุฑุจุงุฑู ุณุงูุงูู</h3>
      <p>ุงู ุณุงูุงูู ุฌูุช ูุฏุฑุช ฺฉุชุงุจุฎุงูู ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู ุทุฑุงุญ ุดุฏู ุงุณุช. </p>
    </div>

    <div class="footer-col">
      <h3>ูพููุฏูุง ููุฏ</h3>
      <ul>
        <li><a href="#">ฺฉุชุงุจุฎุงูู </a></li>
        <li><a href="#">ุณุณุชู ุนุถูุช</a></li>
      </ul>
    </div>

    <div class="footer-col">
      <h3>ุงุฑุชุจุงุท ุจุง ูุง</h3>
      <p>๐ง info@</p>
      <p>โ๏ธ ฐตถ-</p>
      <p>๐ ุจุฑุฌูุฏุ ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู</p>
    </div>
  </div>

  <p class="copy"> ฺฉูู ุญููู ุงู ุณุงูุงูู ูุญููุธ ุงุณุช.</p>
</footer>

<!-- Modal Login/Signup -->
<div id="authModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">โ</span>

    <div id="loginFormBox">
      <h2>๐ ูุฑูุฏ ุจู ุญุณุงุจ</h2>
      <input type="email" id="loginEmail" placeholder="ุงูู" required>
      <input type="password" id="loginPassword" placeholder="ุฑูุฒ ุนุจูุฑ" required>
      <button onclick="login()">ูุฑูุฏ</button>
      <p class="switch-form">ุซุจุชโูุงู ูฺฉุฑุฏุ <a href="#" onclick="showSignup()">ุงุฌุงุฏ ุญุณุงุจ</a></p>
      <p id="loginMsg"></p>
    </div>

    <div id="signupFormBox" style="display:none;">
      <h2>๐ ุซุจุชโูุงู</h2>
      <input type="text" id="signupName" placeholder="ูุงู ู ูุงู ุฎุงููุงุฏฺฏ" required>
      <input type="email" id="signupEmail" placeholder="ุงูู" required>
      <input type="password" id="signupPassword" placeholder="ุฑูุฒ ุนุจูุฑ" required>
      <input type="password" id="signupPassword2" placeholder="ุชฺฉุฑุงุฑ ุฑูุฒ ุนุจูุฑ" required>

      <button onclick="signup()">ุซุจุชโูุงู</button>
      <p class="switch-form">ุญุณุงุจ ุฏุงุฑุ <a href="#" onclick="showLogin()">ูุฑูุฏ</a></p>
      <p id="signupMsg"></p>
    </div>
  </div>
</div>

</div>

<!-- Script -->
<script>
const API = "http://localhost:3000";

const modal = document.getElementById("authModal");
const loginBox = document.getElementById("loginFormBox");
const signupBox = document.getElementById("signupFormBox");

/* ------------------- ูุฑูุฏ / ุซุจุชโูุงู ------------------- */

document.querySelector(".header-icons button[title='ูุฑูุฏ']").onclick = () => {
    modal.style.display = "flex";
    showLogin();
};

function closeModal() { modal.style.display = "none"; }

function showSignup() {
    loginBox.style.display = "none";
    signupBox.style.display = "block";
}

function showLogin() {
    signupBox.style.display = "none";
    loginBox.style.display = "block";
}

/* ------------------- ุซุจุชโูุงู ------------------- */
async function signup() {
  const name = signupName.value;
  const email = signupEmail.value;
  const password = signupPassword.value;
  const pass2 = signupPassword2.value;

  if (password !== pass2) {
    signupMsg.textContent = "โ ุฑูุฒูุง ฺฉุณุงู ูุณุชูุฏ";
    signupMsg.style.color = "red";
    return;
  }

  const res = await fetch(`${API}/api/signup`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({name,email,password})
  });

  const data = await res.json();
  signupMsg.textContent = data.message || data.error;
  signupMsg.style.color = data.error ? "red" : "green";
}

/* ------------------- ูุฑูุฏ ------------------- */
async function login() {
  const email = loginEmail.value;
  const password = loginPassword.value;

  const res = await fetch(`${API}/api/login`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({email,password})
  });

  const data = await res.json();

  if (data.token) {
    localStorage.setItem("token", data.token);
    localStorage.setItem("user", JSON.stringify(data.user));

    userNameDisplay.textContent = data.user.name;
    logoutBtn.style.display = "inline-block";
    openAuth.style.display = "none";

    closeModal();

    window.location.reload();
  } else {
    loginMsg.textContent = data.error;
    loginMsg.style.color = "red";
  }
}

/* ------------------- ููุฏ ฺฉุงุฑุจุฑ ุฐุฎุฑูโุดุฏู ------------------- */
window.addEventListener("DOMContentLoaded", () => {
  const savedUser = localStorage.getItem("user");

  if (savedUser) {
    const userObj = JSON.parse(savedUser);
    userNameDisplay.textContent = userObj.name;

    logoutBtn.style.display = "inline-block";
    openAuth.style.display = "none";

    menuUserName.textContent = userObj.name;

    // ุงฺฏุฑ pending ุจูุฏ ูพุงู ุฑุง ูุดุงู ุจุฏู
    if (userObj.role === "pending") {
      pendingBox.style.display = "block";
    }

    // ูพุฑููุงู โ ูพูู ุนุถู
    menuProfile.onclick = () => {
      window.location.href = "member-panel.html";
    };
  }
});

/* ------------------- ุฌุณุชุฌู ------------------- */
let allBooks = [];

/* ------------------- ููุฏ ฺฉุชุงุจโูุง ------------------- */
async function loadBooks() {
  const grid = document.getElementById("bookGrid");
  const res = await fetch(`${API}/api/public/books`);
  const books = await res.json();
  allBooks = books;

  const savedUser = JSON.parse(localStorage.getItem("user") || "{}");
  const pending = savedUser.role === "pending";

  grid.innerHTML = books.map(book => `
    <div class="book-item">
      <img src="https://cdn-icons-png.flaticon.com/512/29/29302.png" />

      <h4>${book.title}</h4>
      <p><strong>ููุณูุฏู:</strong> ${book.author}</p>
      <p><strong>ุณุงู ฺุงูพ:</strong> ${book.publication_year}</p>
      <p class="copies">๐ ููุฌูุฏ: ${book.available_copies}</p>

      ${
        pending
        ? `<button class="btn-borrow disabled" 
             style="background:#999;cursor:not-allowed;"
             onclick="alert('ูพุณ ุงุฒ ุชุงุฏ ูุฏุฑ ูโุชูุงูุฏ ฺฉุชุงุจโูุง ุฑุง ุงูุงูุช ุจฺฏุฑุฏ.')">
             ุงูุงูุช
           </button>`
        : `<button class="btn-borrow"
             onclick="borrowBook(${book.id})">
             ุงูุงูุช
           </button>`
      }

      <!-- ุฏฺฉูู ุงุทูุงุนุงุช ุจุดุชุฑ -->
      <button class="btn-info" onclick="showBookDetails(${book.id})">
        ุงุทูุงุนุงุช ุจุดุชุฑ
      </button>

    </div>
  `).join("");

  document.getElementById("totalBooks").textContent = books.length;
}

/* ------------------- ุฏฺฉูู ุงุทูุงุนุงุช ุจุดุชุฑ ------------------- */
function showBookDetails(id) {
  window.location.href = `book.html?id=${id}`;
}

/* Borrow โ ูพุงุฏูโุณุงุฒ ุจุนุฏ */
function borrowBook(id) {
  alert("--.");
}


/* ------------------- ุฎุฑูุฌ ------------------- */
logoutBtn.onclick = () => {
  localStorage.removeItem("token");
  localStorage.removeItem("user");
  window.location.reload();
};

/* ููู ูพุฑููุงู */
userNameDisplay.onclick = () => {
  userMenu.style.display = (userMenu.style.display === "none") ? "block" : "none";
};

document.addEventListener("click", (e) => {
  if (!e.target.closest(".header-icons")) {
    userMenu.style.display = "none";
  }
});

/* ------------------- ุฌุณุชุฌู ------------------- */
document.getElementById("searchBtn").onclick = () => {
  const txt = searchInput.value.trim();
  const filtered = allBooks.filter(b =>
    b.title.includes(txt) || b.author.includes(txt) || b.category?.includes(txt)
  );
  renderBooks(filtered);
};


function renderBooks(list) {
  const grid = document.getElementById("bookGrid");
  grid.innerHTML = list
    .map(
      (book) => `
      <div class="book-item">
        <img src="https://cdn-icons-png.flaticon.com/512/29/29302.png" />
        <h4>${book.title}</h4>
        <p><strong>ููุณูุฏู:</strong> ${book.author}</p>
      </div>
    `
    )
    .join("");
}

loadBooks();
</script>

</body>
</html>
