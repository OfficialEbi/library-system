<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>๐ ุณุงูุงูู ูุฏุฑุช ฺฉุชุงุจุฎุงูู ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrapper">

  <!-- Header -->
  <header>
    <div class="container">
      <h1>๐ ฺฉุชุงุจุฎุงูู ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู</h1>
      <nav>
        <ul>
          <li><a href="#" class="active">ุฎุงูู</a></li>
          <li><a href="#">ฺฉุชุงุจโูุง</a></li>
          <li><a href="#">ุฏุฑุจุงุฑู ูุง</a></li>
          <li><a href="#">ุชูุงุณ</a></li>
        </ul>
      </nav>
      <div class="header-icons">
        <span id="userNameDisplay" class="user-name"></span>
      
        <button id="openAuth" title="ูุฑูุฏ">ูุฑูุฏ</button>
      
        <button id="logoutBtn" style="display:none;" title="ุฎุฑูุฌ">๐ช</button>
      
        <!-- ููู ุจุงุฒุดู -->
        <div id="userMenu" class="user-menu" style="display:none;">
          <p id="menuUserName">ูุงู ฺฉุงุฑุจุฑ</p>
          <button id="menuProfile">ูพุฑููุงู</button>
          <button id="menuLogout">ุฎุฑูุฌ</button>
        </div>
      
        <button title="ุชูุธูุงุช">โ๏ธ</button>
      </div>
      
      
      
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-content">
      <h2>ุจู ุณุงูุงูู ูุฏุฑุช ฺฉุชุงุจุฎุงูู ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู ุฎูุด ุขูุฏุฏ</h2>
      <p>ุฏุณุชุฑุณ ุขุณุงู ุจู ฺฉุชุงุจโูุงุ ูุดุฑุงุช ู ููุงุจุน ุขููุฒุด ุฏุฑ ฺฉ ูฺฉุงู</p>
    </div>
  </section>

  <!-- Search -->
  <section class="search-area">
    <div class="tabs">
    </div>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="ุนุจุงุฑุช ููุฑุฏ ูุธุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ ...">
      <button id="searchBtn">๐ ุฌุณุชุฌู</button>
    </div>
  </section>

  <!-- Stats -->
  <section class="stats">
    <div class="stat-card">
      <div class="icon">๐</div>
      <h3>ูุฌููุน ฺฉุชุงุจโูุง</h3>
      <p id="totalBooks">...</p>
    </div>
    <div class="stat-card">
      <div class="icon">๐ค</div>
      <h3>ุงุนุถุง</h3>
      <p>ฒ</p>
    </div>
    <div class="stat-card">
      <div class="icon">๐</div>
      <h3>ุงูุงูุชโ ูุง ูุนุงู ุงู ูุงู</h3>
      <p>ฒฒ</p>
    </div>
  </section>

  <!-- New Books -->
  <section class="new-books">
    <h2>๐ ุชุงุฒูโูุง ฺฉุชุงุจ</h2>
    <div id="bookGrid" class="book-grid">
      <p style="text-align:center;color:#555;">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ ฺฉุชุงุจโูุง...</p>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-col">
        <h3>ุฏุฑุจุงุฑู ุณุงูุงูู</h3>
        <p>ุงู ุณุงูุงูู ุฌูุช ูุฏุฑุช ฺฉุชุงุจุฎุงูู ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู ุทุฑุงุญ ุดุฏู ุงุณุช. </p>
      </div>

      <div class="footer-col">
        <h3>ูพููุฏูุง ููุฏ</h3>
        <ul>
          <li><a href="#">ฺฉุชุงุจุฎุงูู </a></li>
          <li><a href="#"></a></li>
          <li><a href="#">ุณุณุชู ุนุถูุช</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h3>ุงุฑุชุจุงุท ุจุง ูุง</h3>
        <p>๐ง info@</p>
        <p>โ๏ธ ฐตถ-</p>
        <p>๐ ุจุฑุฌูุฏุ ุฏุงูุดฺฏุงู ุงุจูโุญุณุงู</p>
      </div>
    </div>

    <p class="copy"> ฺฉูู ุญููู ุงู ุณุงูุงูู ูุญููุธ ุงุณุช.</p>
  </footer>
<!-- Login / Signup Modal -->
<div id="authModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">โ</span>

    <div id="loginFormBox">
      <h2>๐ ูุฑูุฏ ุจู ุญุณุงุจ</h2>
      <input type="email" id="loginEmail" placeholder="ุงูู" required>
      <input type="password" id="loginPassword" placeholder="ุฑูุฒ ุนุจูุฑ" required>
      <button onclick="login()">ูุฑูุฏ</button>
      <p class="switch-form">ุซุจุชโูุงู ูฺฉุฑุฏุ <a href="#" onclick="showSignup()">ุงุฌุงุฏ ุญุณุงุจ</a></p>
      <p id="loginMsg"></p>
    </div>

    <div id="signupFormBox" style="display:none;">
      <h2>๐ ุซุจุชโูุงู</h2>
      <input type="text" id="signupName" placeholder="ูุงู ู ูุงู ุฎุงููุงุฏฺฏ" required>
      <input type="email" id="signupEmail" placeholder="ุงูู" required>
      <input type="password" id="signupPassword" placeholder="ุฑูุฒ ุนุจูุฑ" required>
      <button onclick="signup()">ุซุจุชโูุงู</button>
      <p class="switch-form">ุญุณุงุจ ุฏุงุฑุ <a href="#" onclick="showLogin()">ูุฑูุฏ</a></p>
      <p id="signupMsg"></p>
    </div>
  </div>
</div>
</div>
  <!-- Script -->
  <script>
    const modal = document.getElementById("authModal");
    const loginBox = document.getElementById("loginFormBox");
    const signupBox = document.getElementById("signupFormBox");

    // ุจุงุฒ ู ุจุณุชู ฺฉุฑุฏู ูพูุฌุฑู
    document.querySelector(".header-icons button[title='ูุฑูุฏ']").onclick = () => {
        modal.style.display = "flex";
        showLogin();
    };
    function closeModal() {
        modal.style.display = "none";
    }

    // ุชุนูุถ ุจู ูุฑู ูุฑูุฏ ู ุซุจุชโูุงู
    function showSignup() {
        loginBox.style.display = "none";
        signupBox.style.display = "block";
    }
    function showLogin() {
        signupBox.style.display = "none";
        loginBox.style.display = "block";
    }

    // ุซุจุชโูุงู
    async function signup() {
        const name = document.getElementById("signupName").value;
        const email = document.getElementById("signupEmail").value;
        const password = document.getElementById("signupPassword").value;
        const msg = document.getElementById("signupMsg");

        try {
            const res = await fetch("http://localhost:3000/api/signup", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, email, password }),
            });
            const data = await res.json();
            msg.textContent = data.message || data.error;
            msg.style.color = data.error ? "red" : "green";
        } catch (err) {
            msg.textContent = "โ ุฎุทุง ุฏุฑ ุงุฑุชุจุงุท ุจุง ุณุฑูุฑ";
            msg.style.color = "red";
        }
    }

    //  ูุฑูุฏ + ุชุดุฎุต ููุด ุงุฏูู 
    async function login() {
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;
        const msg = document.getElementById("loginMsg");

        try {
            const res = await fetch("http://localhost:3000/api/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password }),
            });
            const data = await res.json();

            msg.textContent = data.message || data.error;
            msg.style.color = data.token ? "green" : "red";

            // ุงฺฏุฑ ูุฑูุฏ ูููู ุจูุฏ
            if (data.token) {
                // ุฐุฎุฑู ุชูฺฉู ู ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ
                localStorage.setItem("token", data.token);
                localStorage.setItem("user", JSON.stringify(data.user));

                closeModal();

                // ููุงุด ูุงู ฺฉุงุฑุจุฑ
                document.getElementById("userNameDisplay").textContent = data.user.name;
                document.getElementById("logoutBtn").style.display = "inline-block";
                document.getElementById("openAuth").style.display = "none";
                updateMenuName(data.user.name);

                // โโ ุงฺฏุฑ ุงุฏูู ุงุณุช โ ูุณุชูู ุจุฑูุฏ admin-panel.html
                if (data.user.role === "admin") {
                    window.location.href = "admin-panel.html";
                    return;
                }

                // ุงฺฏุฑ ุงุฏูู ูุจูุฏ โ ูพุงู ุฎูุด ุขูุฏ
                alert("ุฎูุด ุขูุฏุฏ " + data.user.name);
            }

        } catch (err) {
            msg.textContent = "โ ุฎุทุง ุฏุฑ ุงุฑุชุจุงุท ุจุง ุณุฑูุฑ";
            msg.style.color = "red";
        }
    }

    //  ุงฺฏุฑ ุงุฏูู ูุจูุงู ูุงฺฏู ฺฉุฑุฏู โ ุจุนุฏ ุฑูุฑุด ูุณุชูู ุจุฑูุฏ ูพูู ุงุฏูู
    window.addEventListener("DOMContentLoaded", () => {
        const savedUser = localStorage.getItem("user");

        if (savedUser) {
            const userObj = JSON.parse(savedUser);

            document.getElementById("userNameDisplay").textContent = userObj.name;
            document.getElementById("logoutBtn").style.display = "inline-block";
            document.getElementById("openAuth").style.display = "none";
            updateMenuName(userObj.name);

            if (userObj.role === "admin") {
                window.location.href = "admin-panel.html";
                return;
            }
        }
    });

    // ุจุณุชู ูพูุฌุฑู ุจุง ฺฉูฺฉ ุจุฑูู
    window.onclick = (e) => {
        if (e.target === modal) closeModal();
    };

    // ุฏุฑุงูุช ฺฉุชุงุจโูุง ุงุฒ API
    async function loadBooks() {
        const grid = document.getElementById("bookGrid");
        try {
            const res = await fetch("http://localhost:3000/api/books");
            const books = await res.json();
            allBooks = books;

            if (!books.length) {
                grid.innerHTML = `<p style="text-align:center;">ูฺ ฺฉุชุงุจ ุซุจุช ูุดุฏู.</p>`;
                return;
            }

            grid.innerHTML = books.map(book => `
                <div class="book-item">
                    <img src="https://cdn-icons-png.flaticon.com/512/29/29302.png" />
                    <h4>${book.title}</h4>
                    <p><strong>ููุณูุฏู:</strong> ${book.author || '-'}</p>
                    <p><strong>ุณุงู ฺุงูพ:</strong> ${book.publication_year || '-'}</p>
                    <p><strong>ุฏุณุชูโุจูุฏ:</strong> ${book.category || '-'}</p>
                    <p class="copies">๐ ูุณุฎูโูุง ููุฌูุฏ: ${book.available_copies}</p>
                    <button>ูุดุงูุฏู</button>
                </div>
            `).join("");

            document.getElementById("totalBooks").textContent = books.length.toLocaleString('fa-IR');

        } catch (err) {
            grid.innerHTML = `<p style="color:red;">โ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ฺฉุชุงุจโูุง</p>`;
        }
    }

    // ุฎุฑูุฌ
    document.getElementById("logoutBtn").onclick = () => {
        localStorage.removeItem("token");
        localStorage.removeItem("user");

        document.getElementById("userNameDisplay").textContent = "";
        document.getElementById("openAuth").style.display = "inline-block";
        document.getElementById("logoutBtn").style.display = "none";

        alert("๐ช ุฎุงุฑุฌ ุดุฏุฏ");
    };

    // ุจุงุฒ ุดุฏู ููู
    const userMenu = document.getElementById("userMenu");
    const userNameDisplay = document.getElementById("userNameDisplay");

    userNameDisplay.onclick = () => {
        userMenu.style.display = (userMenu.style.display === "none") ? "block" : "none";
    };

    function updateMenuName(name) {
        document.getElementById("menuUserName").textContent = name;
    }

    document.addEventListener("click", (e) => {
        if (!e.target.closest(".header-icons")) {
            userMenu.style.display = "none";
        }
    });

    // ุฌุณุชุฌู
    document.getElementById("searchBtn").onclick = () => {
        const text = document.getElementById("searchInput").value.trim();
        const filtered = allBooks.filter(b =>
            b.title.includes(text) ||
            b.author.includes(text) ||
            b.category.includes(text)
        );
        renderBooks(filtered);
    };

    document.getElementById("searchInput").addEventListener("keyup", (e) => {
        if (e.key === "Enter") document.getElementById("searchBtn").click();
    });

    document.getElementById("menuLogout").onclick = () => {
        localStorage.removeItem("token");
        localStorage.removeItem("user");
        userMenu.style.display = "none";
        alert("๐ช ุฎุงุฑุฌ ุดุฏุฏ");
    };

    function renderBooks(bookList) {
        const grid = document.getElementById("bookGrid");
        grid.innerHTML = bookList.map(book => `
            <div class="book-item">
                <img src="https://cdn-icons-png.flaticon.com/512/29/29302.png" />
                <h4>${book.title}</h4>
                <p><strong>ููุณูุฏู:</strong> ${book.author || '-'}</p>
                <p><strong>ุณุงู ฺุงูพ:</strong> ${book.publication_year || '-'}</p>
                <p><strong>ุฏุณุชูโุจูุฏ:</strong> ${book.category || '-'}</p>
                <p class="copies">๐ ูุณุฎูโูุง ููุฌูุฏ: ${book.available_copies}</p>
                <button>ูุดุงูุฏู</button>
            </div>
        `).join("");
    }

    let allBooks = [];
    loadBooks();
</script>

</body>
</html>
